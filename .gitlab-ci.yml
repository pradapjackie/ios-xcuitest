stages:
  - test

variables:
  XCODE_VERSION: "12.5"
  SIMULATOR_DEVICE: "iPhone 12"

before_script:
  - apt-get update -qy
  - apt-get install -y ruby-full
  - gem install bundler
  - bundle install
  - bundle exec pod install

xcode_test:
  stage: test
  script:
    - xcode-select --install || true
    - xcodebuild -version -sdk

    # Install necessary tools
    - gem install xcpretty

    # Build and test the project
    - xcodebuild clean build -project xcuitestproject.xcodeproj -scheme xcuitestproject -destination "platform=iOS Simulator,name=$SIMULATOR_DEVICE" | xcpretty -c
    - xcodebuild test -project xcuitestproject.xcodeproj -scheme xcuitestprojectUITests -destination "platform=iOS Simulator,name=$SIMULATOR_DEVICE" | xcpretty -c
